#!/usr/bin/env python3

import os
import shutil
import subprocess

from typing import List
from tempfile import TemporaryDirectory

current_user = os.getuid()

def run(*args: str):
	subprocess.run(args, check=True)

with TemporaryDirectory() as path:
	os.chdir(path)

	if current_user == 0:
		print("Run nixos-rebuild...")
		run('nixos-rebuild', 'build')
		run('nvd', 'diff', '/run/current-system', 'result/')
	else:
		print("Run home-manager...")
		run('home-manager', 'build', '--flake', '/etc/nixos')
		run('nvd', 'diff', '/nix/var/nix/profiles/per-user/mzhukov/home-manager', 'result/')
